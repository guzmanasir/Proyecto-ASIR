/**
 * Created by guzman on 4/02/17.
 */

/**
 * Core librería
 */
angular.module("proyecto", [
    'ui.router',
    'ngMaterial',
    'satellizer'
]).config(function($mdThemingProvider) {
    $mdThemingProvider.theme('default')
        .primaryPalette('red')
        .accentPalette('blue');
});
/**
 * Created by guzman on 4/02/17.
 */



(function() {
    function routes($stateProvider,$locationProvider,$authProvider){
        $locationProvider.html5Mode(true);
        $authProvider.loginUrl = '/loginForm';
        $authProvider.tokenName = 'token';
        $authProvider.tokenPrefix = 'satellizer';
        $stateProvider
            .state('login',{
                url: "/inicio",
                controller: 'loginCtrl',
                controllerAs: 'lc',
                templateUrl: '/login'
            })

            .state('registro',{
                url: "/signup",
                controller: 'registroCtrl',
                controllerAs: 'rc',
                templateUrl: '/registro'
            })

            .state('main',{
                url: "/index",
                controller: 'frameCtrl',
                controllerAs: 'fc',
                templateUrl: '/users/frame'
            })
    }

    angular.module('proyecto')
        .config(['$stateProvider', '$locationProvider', '$authProvider',routes]);

})();


/**
 * Created by guzman on 4/02/17.
 */



(function() {
    function frameCtrl($http,$state){
        var vm = this;
    }

    angular.module('proyecto')
        .controller('frameCtrl',['$http','$state',frameCtrl]);

})();

/**
 * Created by guzman on 4/02/17.
 */



(function() {
    function loginCtrl($http,$auth,$state){
        var vm = this;
        vm.login = function(){

            console.log("Info login", vm.usernameModel, vm.passwordModel)
            /**
             * TODO: Llamada al servidor
             */
            var json = {
                usernameServer : vm.usernameModel,
                passwordServer : vm.passwordModel
            };
            $auth.login(json)
                .then(function(response){
                        if (response.data.codigo === 500)
                            swal(
                                'Oops...',
                                'Error al iniciar sesión',
                                'error'
                            )
                        else{
                            $state.go('main')
                        }

                    },
                    function(response) {
                        swal(
                            'Oops...',
                            'Error de servidor',
                            'error'
                        )

                    });
        }
    }

    angular.module('proyecto')
        .controller('loginCtrl',['$http','$auth','$state',loginCtrl]);

})();

/**
 * Created by guzman on 4/02/17.
 */


(function() {
    function registroCtrl($http){
        var vm = this;
        vm.registro = function(){
            var json = {
                usernameRegistro : vm.usernameModel,
                passwordRegistro : vm.passwordModel,
                emailRegistro : vm.emailModel
            };

            $http.post('/registerForm',json)
                .then(function(response){
                        console.log("respuesta",response);
                        vm.status = "OK";
                    },
                    function(response) {
                        vm.status = "Fallo";
                        console.log("fallo")
                        swal(
                            'Oops...',
                            'Error al registrar!',
                            'error'
                        )
                    });

        }
    }

    angular.module('proyecto')
        .controller('registroCtrl',['$http',registroCtrl]);

})();
